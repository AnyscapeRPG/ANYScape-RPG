<div class="container"><input class="sheet-tab-value" type="hidden" name="attr_sheet_container" value="equipment" />
<div class="nav-tab-container">
    <button class="nav-tab-btn btn-skill" type="action" name="act_skills">Umiejętności</button>
    <button class="nav-tab-btn btn-equipment" type="action" name="act_equipment">Wyposażenie</button>
    <button class="nav-tab-btn btn-data" type="action" name="act_data">Dane Użytkownika</button>
</div>
<div class="menu-roll">
    <div>
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="0" checked>
                Łatwy
            </label>
        </div>
    
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="1">
                Przeciętny
            </label>
        </div>
    
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="2">
                Problematyczny
            </label>
        </div>
    
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="3">
                Trudny
            </label>
        </div>
    
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="4">
                Bardzo Trudny
            </label>
        </div>
    
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="5">
                Cholernie Trudny
            </label>
        </div>
    
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="6">
                Fart
            </label>
            <input type="radio" class="diffculty-level-value-right-radio" name="attr_difficulty_max_lvl" value="6" checked>
        </div>
    
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="7">
                Mistrzowski
            </label>
            <input type="radio" class="diffculty-level-value-right-radio" name="attr_difficulty_max_lvl" value="7">
        </div>
    
        <div class="diffculty-level-value">
            <label class="diffculty-level-value-text">
                <input type="radio" class="diffculty-level-value-left-radio" name="attr_difficulty_lvl" value="8">
                Arcymistrzowski
            </label>
            <input type="radio" class="diffculty-level-value-right-radio" name="attr_difficulty_max_lvl" value="8">
        </div>
    </div>
    
    <div>
        <button class="hitloc" type="roll" name="roll_hitloc" title="Rzut na lokację"
            value="&{template:hit-location} {{name=@{character_name}}} {{result=[[1d19]]}}">Lokalizacja</button>

        <button class="open" type="roll" name="roll_open"
             value="&{template:test} {{test_name=@{last_test_name}}} {{difficulty_lvl_val=[[@{last_classic_difficulty}]]}} {{test_type_txt=[[1]]}} {{res=[[@{last_open_test_value}]]}}"></button>

        <button class="combat" type="roll" name="roll_combat"
            value="&{template:test} {{test_name=@{last_test_name}}} {{dice=[[@{last_dice_number}]]}}{{difficulty_lvl_val=[[@{last_combat_difficulty}]]}} {{test_type_txt=[[2]]}} {{roll1=[[@{last_combat_roll1}]]}} {{roll2=[[@{last_combat_roll2}]]}} {{roll3=[[@{last_combat_roll3}]]}} {{status1=[[@{last_combat_status1}]]}} {{status2=[[@{last_combat_status2}]]}} {{status3=[[@{last_combat_status3}]]}}"></button>
    </div>
</div>
<div class="data-container-tab" style="color: wheat;">
    imie
    <input type="text" name="attr_character_name">
</div>
<div class="skill-container-tab">
    <div class="wsp-container">
        <p class="wsp-label">Zręczność</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_zre">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_zre_mod">
            </div>
            <div class="wsp-pair">
                <button type="action" name="act_test_zre" class="roll-button wsp-roll-button"></button>
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="number" min="1" name="attr_difficulty_zre" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name">Walka wręcz</span>
            <div class="skill-container">
                <button type="action" name="act_test_bijatyka" class="roll-button"></button>
                <input class="skill-name-input" value="Bijatyka" readonly>
                <input type="number" value="0" name="attr_bijatyka">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_br_ręczna" class="roll-button"></button>
                <input class="skill-name-input" value="Broń ręczna" readonly>
                <input type="number" value="0" name="attr_br_ręczna">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_rzucanie" class="roll-button"></button>
                <input class="skill-name-input" value="Rzucanie" readonly>
                <input type="number" value="0" name="attr_rzucanie">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Prowadzenie pojazdów</span>
            <div class="skill-container">
                <button type="action" name="act_test_samochód" class="roll-button"></button>
                <input class="skill-name-input" value="Samochód" readonly>
                <input type="number" value="0" name="attr_samochód">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_motocykl" class="roll-button"></button>
                <input class="skill-name-input" value="Motocykl" readonly>
                <input type="number" value="0" name="attr_motocykl">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_ciężarówka" class="roll-button"></button>
                <input class="skill-name-input" value="Ciężarówka" readonly>
                <input type="number" value="0" name="attr_ciężarówka">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Zdolności manulane</span>
            <div class="skill-container">
                <button type="action" name="act_test_kr_kiesz" class="roll-button"></button>
                <input class="skill-name-input" value="Kradzież kieszonkowa" readonly>
                <input type="number" value="0" name="attr_kr_kiesz">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_otw_zamków" class="roll-button"></button>
                <input class="skill-name-input" value="Otwieranie zamków" readonly>
                <input type="number" value="0" name="attr_otw_zamków">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_zw_dłonie" class="roll-button"></button>
                <input class="skill-name-input" value="Zwinne dłonie" readonly>
                <input type="number" value="0" name="attr_zw_dłonie">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Broń strzelecka</span>
            <div class="skill-container">
                <button type="action" name="act_test_pistolety" class="roll-button"></button>
                <input class="skill-name-input" value="Pistolety" readonly>
                <input type="number" value="0" name="attr_pistolety">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_karabiny" class="roll-button"></button>
                <input class="skill-name-input" value="Karabiny" readonly>
                <input type="number" value="0" name="attr_karabiny">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_br_maszynowa" class="roll-button"></button>
                <input class="skill-name-input" value="Broń maszynowa" readonly>
                <input type="number" value="0" name="attr_br_maszynowa">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Broń dystansowa</span>
            <div class="skill-container">
                <button type="action" name="act_test_łuk" class="roll-button"></button>
                <input class="skill-name-input" value="Łuk" readonly>
                <input type="number" value="0" name="attr_łuk">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_kusza" class="roll-button"></button>
                <input class="skill-name-input" value="Kusza" readonly>
                <input type="number" value="0" name="attr_kusza">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_proca" class="roll-button"></button>
                <input class="skill-name-input" value="Proca" readonly>
                <input type="number" value="0" name="attr_proca">
            </div>
        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label">Percepcja</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_per">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_per_mod">
            </div>
            <button type="action" name="act_test_per" class="roll-button wsp-roll-button"></button>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="number" name="attr_difficulty_per" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name">Orientacja w terenie</span>
            <div class="skill-container">
                <button type="action" name="act_test_wycz_kier" class="roll-button"></button>
                <input class="skill-name-input" value="Wyczucie kierunku" readonly>
                <input type="number" value="0" name="attr_wycz_kier">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_przyg_pułapki" class="roll-button"></button>
                <input class="skill-name-input" value="Przygotowanie pułapki" readonly>
                <input type="number" value="0" name="attr_przyg_pułapki">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_tropienie" class="roll-button"></button>
                <input class="skill-name-input" value="Tropienie" readonly>
                <input type="number" value="0" name="attr_tropienie">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Spostrzegawczość</span>
            <div class="skill-container">
                <button type="action" name="act_test_nasłuchiwanie" class="roll-button"></button>
                <input class="skill-name-input" value="Nasłuchiwanie" readonly>
                <input type="number" value="0" name="attr_nasłuchiwanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_wypatrywanie" class="roll-button"></button>
                <input class="skill-name-input" value="Wypatrywanie" readonly>
                <input type="number" value="0" name="attr_wypatrywanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_czujność" class="roll-button"></button>
                <input class="skill-name-input" value="Czujność" readonly>
                <input type="number" value="0" name="attr_czujność">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Kamuflaż</span>
            <div class="skill-container">
                <button type="action" name="act_test_skradanie" class="roll-button"></button>
                <input class="skill-name-input" value="Skradanie się" readonly>
                <input type="number" value="0" name="attr_skradanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_ukrywanie" class="roll-button"></button>
                <input class="skill-name-input" value="Ukrywanie się" readonly>
                <input type="number" value="0" name="attr_ukrywanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_maskowanie" class="roll-button"></button>
                <input class="skill-name-input" value="Maskowanie" readonly>
                <input type="number" value="0" name="attr_maskowanie">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Przetrwanie</span>
            <div class="skill-container">
                <button type="action" name="act_test_łowiectwo" class="roll-button"></button>
                <input class="skill-name-input" value="Łowiectwo" readonly>
                <input type="number" value="0" name="attr_łowiectwo">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_znaj_teren" class="roll-button"></button>
                <input class="skill-name-input" value="Znajomość terenu" readonly>
                <input type="number" value="0" name="attr_znaj_teren">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_zdob_wody" class="roll-button"></button>
                <input class="skill-name-input" value="Zdobywanie wody" readonly>
                <input type="number" value="0" name="attr_zdob_wody">
            </div>
        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label">Charakter</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_cha">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_cha_mod">
            </div>
            <button type="action" name="act_test_cha" class="roll-button wsp-roll-button"></button>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="number" name="attr_difficulty_cha" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name">Negocjacje</span>
            <div class="skill-container">
                <button type="action" name="act_test_zastraszanie" class="roll-button"></button>
                <input class="skill-name-input" value="Zastraszanie" readonly>
                <input type="number" value="0" name="attr_zastraszanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_perswazja" class="roll-button"></button>
                <input class="skill-name-input" value="Persfazja" readonly>
                <input type="number" value="0" name="attr_perswazja">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_zdol_przywódcze" class="roll-button"></button>
                <input class="skill-name-input" value="Zdolności przywódcze" readonly>
                <input type="number" value="0" name="attr_zdol_przywódcze">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Empatia</span>
            <div class="skill-container">
                <button type="action" name="act_test_postrz_emocje" class="roll-button"></button>
                <input class="skill-name-input" value="Postrzeganie emocji" readonly>
                <input type="number" value="0" name="attr_postrz_emocje">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_blef" class="roll-button"></button>
                <input class="skill-name-input" value="Blef" readonly>
                <input type="number" value="0" name="attr_blef">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_opieka_zwierz" class="roll-button"></button>
                <input class="skill-name-input" value="Opieka nad zwierzętami" readonly>
                <input type="number" value="0" name="attr_opieka_zwierz">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Siła woli</span>
            <div class="skill-container">
                <button type="action" name="act_test_odp_na_ból" class="roll-button"></button>
                <input class="skill-name-input" value="Odporność na ból" readonly>
                <input type="number" value="0" name="attr_odp_na_ból">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_niezłomność" class="roll-button"></button>
                <input class="skill-name-input" value="Niezłomność" readonly>
                <input type="number" value="0" name="attr_niezłomność">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_morale" class="roll-button"></button>
                <input class="skill-name-input" value="Morale" readonly>
                <input type="number" value="0" name="attr_morale">
            </div>
        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label">Spryt</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_spr">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_spr_mod">
            </div>
            <button type="action" name="act_test_spr" class="roll-button wsp-roll-button"></button>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="number" name="attr_difficulty_spr" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name">Medycyna</span>
            <div class="skill-container">
                <button type="action" name="act_test_pier_pomoc" class="roll-button"></button>
                <input class="skill-name-input" value="Pierwsza Pomoc" readonly>
                <input type="number" value="0" name="attr_pier_pomoc">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_lecz_ran" class="roll-button"></button>
                <input class="skill-name-input" value="Leczenie ran" readonly>
                <input type="number" value="0" name="attr_lecz_ran">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_lecz_chorób" class="roll-button"></button>
                <input class="skill-name-input" value="Leczenie chorób" readonly>
                <input type="number" value="0" name="attr_lecz_chorób">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Technika</span>
            <div class="skill-container">
                <button type="action" name="act_test_mechanika" class="roll-button"></button>
                <input class="skill-name-input" value="Mechanika" readonly>
                <input type="number" value="0" name="attr_mechanika">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_elektronika" class="roll-button"></button>
                <input class="skill-name-input" value="Elektronika" readonly>
                <input type="number" value="0" name="attr_elektronika">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_komputery" class="roll-button"></button>
                <input class="skill-name-input" value="Komputery" readonly>
                <input type="number" value="0" name="attr_komputery">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Sprzęt</span>
            <div class="skill-container">
                <button type="action" name="act_test_m_ciężkie" class="roll-button"></button>
                <input class="skill-name-input" value="Maszyny ciężkie" readonly>
                <input type="number" value="0" name="attr_m_ciężkie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_w_bojowe" class="roll-button"></button>
                <input class="skill-name-input" value="Wozy bojowe" readonly>
                <input type="number" value="0" name="attr_w_bojowe">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_kutry" class="roll-button"></button>
                <input class="skill-name-input" value="Kutry" readonly>
                <input type="number" value="0" name="attr_kutry">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Pirotechnika</span>
            <div class="skill-container">
                <button type="action" name="act_test_rusznikarstwo" class="roll-button"></button>
                <input class="skill-name-input" value="Rusznikarstwo" readonly>
                <input type="number" value="0" name="attr_rusznikarstwo">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_wyrzutnie" class="roll-button"></button>
                <input class="skill-name-input" value="Wyrzutnie" readonly>
                <input type="number" value="0" name="attr_wyrzutnie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_mat_wyb" class="roll-button"></button>
                <input class="skill-name-input" value="Materiały wybuchowe" readonly>
                <input type="number" value="0" name="attr_mat_wyb">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Wiedza ogólna</span>
            <div class="skill-container">
                <button type="action" name="act_test_w_ogólna_1" class="roll-button"></button>
                <input class="skill-name-input" placeholder="Wiedza ogólna" >
                <input type="number" value="0" name="attr_w_ogólna_1">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_w_ogólna_2" class="roll-button"></button>
                <input class="skill-name-input" placeholder="Wiedza ogólna" >
                <input type="number" value="0" name="attr_w_ogólna_2">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_w_ogólna_3" class="roll-button"></button>
                <input class="skill-name-input" placeholder="Wiedza ogólna" >
                <input type="number" value="0" name="attr_w_ogólna_3">
            </div>
        </div>
    </div>
    <div class="wsp-container">
        <p class="wsp-label">Budowa</p>
        <div class="wsp-inputs">
            <div class="wsp-pair">
                <p class="wsp-pair-title">Baza</p>
                <input class="wsp-values" value="0" type="number" name="attr_bud">
            </div>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Mod</p>
                <input class="wsp-values" value="0" type="number" name="attr_bud_mod">
            </div>
            <button type="action" name="act_test_bud" class="roll-button wsp-roll-button"></button>
            <div class="wsp-pair">
                <p class="wsp-pair-title">Próg</p>
                <input class="wsp-values" value="0" type="number" name="attr_difficulty_bud" readonly>
            </div>
        </div>
    </div>
    <div class="skills-container">
        <div class="skills-package-container">
            <span class="skills-package-name">Sprawność</span>
            <div class="skill-container">
                <button type="action" name="act_test_kondycja" class="roll-button"></button>
                <input class="skill-name-input" value="Kondycja" readonly>
                <input type="number" value="0" name="attr_kondycja">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_pływanie" class="roll-button"></button>
                <input class="skill-name-input" value="Pływanie" readonly>
                <input type="number" value="0" name="attr_pływanie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_wspinaczka" class="roll-button"></button>
                <input class="skill-name-input" value="Wspinaczka" readonly>
                <input type="number" value="0" name="attr_wspinaczka">
            </div>
        </div>
        <div class="skills-package-container">
            <span class="skills-package-name">Jeździectwo</span>
            <div class="skill-container">
                <button type="action" name="act_test_j_konna" class="roll-button"></button>
                <input class="skill-name-input" value="Jazda Konna" readonly>
                <input type="number" value="0" name="attr_j_konna">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_powożenie" class="roll-button"></button>
                <input class="skill-name-input" value="Powożenie" readonly>
                <input type="number" value="0" name="attr_powożenie">
            </div>
            <div class="skill-container">
                <button type="action" name="act_test_ujeżdżanie" class="roll-button"></button>
                <input class="skill-name-input" value="Ujeżdzanie" readonly>
                <input type="number" value="0" name="attr_ujeżdżanie">
            </div>
        </div>
    </div>
</div>
<div class="equipment-container-tab">
    <div>
        <h1>Broń Ręczna</h1>
        <div class="package-attack-type">
            <p><input type="radio" name="attr_melee_attack_type" value="0" checked>Atak</p>
            <p><input type="radio" name="attr_melee_attack_type" value="1">Obrona</p>
        </div>
        <fieldset class="repeating_weapons">
            <div class="weapon-frame">
                <div class="weapon-name-container">
                    <label class="weapon-name">
                        Nazwa
                        <input type="text" class="input-weapon-default input-weapon-name" name="attr_weapon_name">
                        <button type="action" name="act_rolledweapon">Roll</button>
                        <input type="text" class="input-weapon-default weapon-bonus" placeholder="A+"
                            title="Bonus do Ataku">
                        <input type="text" class="input-weapon-default weapon-bonus" placeholder="O+"
                            title="Bonus do Obrony">
                        <select class="select_default" name="attr_weapon_segment">
                            <option value="1">1s</option>
                            <option value="2">2s</option>
                            <option value="3" selected>3s</option>
                        </select>
                    </label>
                </div>
                <div class="weapon-data-container">
                    <label class="weapon-skill">
                        Umiejętność
                        <input type="hidden" name="attr_weapon_skill_value" />
                    <select class="select_default" name="attr_weapon_skill">
                            <option value="0">-------</option>
                            <option value="bijatyka">Bijatyka</option>
                            <option value="br_ręczna">Broń ręczna</option>
                            <option value="rzucanie">Rzucanie</option>
                        </select>
                    </label>
                    <label class="weapon-damage">
                        Obrażenia
                        <input type="text" class="input-weapon-default input-weapon-damage" name="attr_weapon_damage">
                    </label>
                    <label class="weapon-pp">PP
                        <input type="text" class="input-weapon-default input-weapon-pp" title="Punkty Przebicia"
                            name="attr_weapon_pp">
                    </label>
                </div>
                <div class="weapon-data-container">
                    <label class="weapon-facilities">Ułatwienia
                        <input class="input-weapon-default input-weapon-facilities" type="text" placeholder="0">
                        %
                    </label>
                    <label class="weapon-impediments">Utrudnienia
                        <input class="input-weapon-default input-weapon-impediments" type="text" placeholder="0">
                        %
                    </label>
                </div>
                <div class="weapon-description-container">
                    <textarea class="weapon-description" name="attr_weapon_description" placeholder="Dodatkowy opis..."
                        rows="2"></textarea>
                </div>
            </div>
        </fieldset>

    </div>
    <div>
        <h1>Broń Dystansowa</h1>
    </div>
    <fieldset class="repeating_ranges">
        <div class="range-frame">
            <div class="range-name-container">
                <label class="range-name">
                    Nazwa
                    <input type="text" class="input-range-default input-range-name" name="attr_range_name">
                    <button type="action" name="act_rolledrange">Roll</button>
                    <select class="select_default small" name="attr_range_segment">
                        <option value="1" selected>1s</option>
                        <option value="2">2s</option>
                        <option value="3">3s</option>
                    </select>
                </label>
            </div>
            <div class="range-data-container">
                <label class="range-skill">
                    Umiejętność
                    <input type="hidden" name="attr_range_skill_value" />
                    <select class="select_default" name="attr_range_skill">
                        <option value="0">-------</option>
                        <option value="pistolety">Pistolety</option>
                        <option value="karabiny">Karabiny</option>
                        <option value="br_maszynowa">Broń maszynowa</option>
                        <option value="łuk">Łuk</option>
                        <option value="kusza">Kusza</option>
                        <option value="proca">Proca</option>
                    </select>
                </label>
                <label class="range-damage">
                    Obrażenia
                    <input type="text" class="input-range-default input-range-damage" name="attr_range_damage">
                </label>
                <label class="range-pp">PP
                    <input type="text" class="input-range-default input-range-pp" title="Punkty Przebicia"
                        name="attr_range_pp">
                </label>
                <label class="range-jam">
                    Zacięcie<input type="text" class="input-range-default input-range-jam" title="Zacięcie broni"
                        name="attr_range_jam">
                </label>
                <label class="range-ammo">Amunicja
                    <input type="text" class="input-range-default input-range-ammo" title="Amunicja aktualna">/
                    <input type="text" class="input-range-default input-range-ammo-max" placeholder="Max"
                        title="Maksymalna Amunicja">
                </label>

            </div>
            <div class="range-type-container">
                <input class="type-range-value" type="hidden" name="attr_range_type_value" value="P" readonly>
                <div>
                    <label class="select_range_type">Typ broni
                        <select class="select_default" name="attr_range_type">
                            <option value="P" title="Pistolety, Lekkie Kusze, Broń Odprzodowa, Pistolety, Samopały">
                                P
                            </option>
                            <option value="PM"
                                title="Pistolety Maszynowe, Cięzkie Kusze, Karabiny Samopały, Granatniki, Winchester, Miotacz">
                                PM
                            </option>
                            <option value="K" title="Karabiny i Karabinki, Granatniki Automoatyczne">K</option>
                            <option value="S" title="Karabiny Wyborowe, Przeciwsprzętowe">S</option>
                            <option value="SR" title="Śrutówki">ŚR</option>
                        </select></label>
                </div>
                <div class="range_p">
                    <label class="range_label">Odległość
                        <select class="select_default range_difficulty" name="attr_range_difficulty">
                            <option value="0" title="0%">Do 10m</option>
                            <option value="20" title="20%">Do 20m</option>
                            <option value="40" title="40%">Do 30m</option>
                            <option value="80" title="80%">Do 40m</option>
                            <option value="120" title="120%">Do 60m</option>
                            <option value="160" title="160%">Do 80m</option>
                        </select>
                    </label>
                </div>
                <div class="range_pm">
                    <label class="range_label">Odległość
                        <select class="select_default range_difficulty" name="attr_range_difficulty">
                            <option value="0" title="0%">Do 10m</option>
                            <option value="10" title="10%">Do 20m</option>
                            <option value="20" title="20%">Do 30m</option>
                            <option value="30" title="30%">Do 40m</option>
                            <option value="40" title="40%">Do 60m</option>
                            <option value="60" title="60%">Do 80m</option>
                            <option value="80" title="80%">Do 100m</option>
                            <option value="120" title="120%">Do 150m</option>
                            <option value="160" title="160%">Do 200m</option>
                        </select>
                    </label>
                </div>
                <div class="range_k">
                    <label class="range_label">Odległość
                        <select class="select_default range_difficulty" name="attr_range_difficulty">
                            <option value="0" title="0%">Do 10m</option>
                            <option value="0" title="0%">Do 20m</option>
                            <option value="10" title="10%">Do 30m</option>
                            <option value="10" title="10%">Do 40m</option>
                            <option value="20" title="20%">Do 60m</option>
                            <option value="20" title="20%">Do 80m</option>
                            <option value="30" title="30%">Do 100m</option>
                            <option value="40" title="40%">Do 150m</option>
                            <option value="60" title="60%">Do 200m</option>
                            <option value="80" title="80%">Do 250m</option>
                            <option value="120" title="120%">Do 300m</option>
                            <option value="160" title="160%">Do 400m</option>
                        </select>
                    </label>
                </div>
                <div class="range_s">
                    <label class="range_label">Odległość
                        <select class="select_default range_difficulty" name="attr_range_difficulty">
                            <option value="0" title="0%">Do 10m</option>
                            <option value="0" title="0%">Do 20m</option>
                            <option value="10" title="10%">Do 30m</option>
                            <option value="10" title="10%">Do 40m</option>
                            <option value="20" title="20%">Do 60m</option>
                            <option value="20" title="20%">Do 80m</option>
                            <option value="30" title="30%">Do 100m</option>
                            <option value="30" title="30%">Do 150m</option>
                            <option value="40" title="40%">Do 200m</option>
                            <option value="40" title="40%">Do 250m</option>
                            <option value="60" title="60%">Do 300m</option>
                            <option value="80" title="80%">Do 400m</option>
                            <option value="100" title="100%">Do 600m</option>
                            <option value="120" title="120%">Do 1000m</option>
                            <option value="160" title="160%">Do 1500m</option>
                        </select>
                    </label>
                </div>
                <div class="range_sr">
                    <label class="range_label">Odległość
                        <select class="select_default range_difficulty" name="attr_range_difficulty">
                            <option value="-30" title="-30%">Do 10m</option>
                            <option value="0" title="0%">Do 20m</option>
                            <option value="30" title="30%">Do 30m</option>
                        </select>
                    </label>
                </div>
                <div>
                    <label class="range_location">Lokalizacja
                        <select class="select_default" name="attr_range_location">
                            <option value="0" title="0%">Bez celowania</option>
                            <option value="80" title="80%">Głowa</option>
                            <option value="80" title="80%">Miejsce Witalne</option>
                            <option value="20" title="20%">Korpus</option>
                            <option value="60" title="60%">Ręce</option>
                            <option value="40" title="40%">Nogi</option>
                        </select>
                    </label>
                </div>
            </div>
            <div class="range-data-container">
                <label class="range-facilities">Ułatwienia
                    <input class="input-range-default input-range-facilities" type="text" placeholder="0">
                    %
                </label>
                <label class="range-impediments">Utrudnienia
                    <input class="input-range-default input-range-impediments" type="text" placeholder="0">
                    %
                </label>
            </div>
            <div class="range-description-container">
                <textarea class="range-description" name="attr_range_description" placeholder="Dodatkowy opis..."
                    rows="2"></textarea>
            </div>
        </div>
    </fieldset>
</div>
</div><script type="text/worker">
//####################################
//###############CODES################
//####################################
const wsp_code = ["zre", "per", "cha", "spr", "bud"];
const wsp_code_translate = {
  zre: "Zręczność",
  per: "Percepcja",
  cha: "Charakter",
  spr: "Spryt",
  bud: "Budowa",
};
const skill_code = {
  zre: [
    "bijatyka",
    "br_ręczna",
    "rzucanie",
    "samochód",
    "motocykl",
    "ciężarówka",
    "kr_kiesz",
    "otw_zamków",
    "zw_dłonie",
    "pistolety",
    "karabiny",
    "br_maszynowa",
    "łuk",
    "kusza",
    "proca",
  ],
  per: [
    "wycz_kier",
    "przyg_pułapki",
    "tropienie",
    "nasłuchiwanie",
    "wypatrywanie",
    "czujność",
    "skradanie",
    "ukrywanie",
    "maskowanie",
    "łowiectwo",
    "znaj_teren",
    "zdob_wody",
  ],
  cha: [
    "zastraszanie",
    "perswazja",
    "zdol_przywódcze",
    "postrz_emocje",
    "blef",
    "opieka_zwierz",
    "odp_na_ból",
    "niezłomność",
    "morale",
  ],
  spr: [
    "pier_pomoc",
    "lecz_ran",
    "lecz_chorób",
    "mechanika",
    "elektronika",
    "komputery",
    "m_ciężkie",
    "w_bojowe",
    "kutry",
    "rusznikarstwo",
    "wyrzutnie",
    "mat_wyb",
    "w_ogólna_1",
    "w_ogólna_2",
    "w_ogólna_3",
  ],
  bud: [
    "kondycja",
    "pływanie",
    "wspinaczka",
    "j_konna",
    "powożenie",
    "ujeżdżanie",
  ],
};
const skill_code_translate = {
  bijatyka: "Bijatyka",
  br_ręczna: "Broń ręczna",
  rzucanie: "Rzucanie",
  samochód: "Samochód",
  motocykl: "Motocykl",
  ciężarówka: "Ciężarówka",
  kr_kiesz: "Kradzież kieszonkowa",
  otw_zamków: "Otwieranie zamków",
  zw_dłonie: "Zwinne dłonie",
  pistolety: "Pistolety",
  karabiny: "Karabiny",
  br_maszynowa: "Broń maszynowa",
  łuk: "Łuk",
  kusza: "Kusza",
  proca: "Proca",

  wycz_kier: "Wyczucie kierunku",
  przyg_pułapki: "Przygotowanie pułapki",
  tropienie: "Tropienie",
  nasłuchiwanie: "Nasłuchiwanie",
  wypatrywanie: "Wypatrywanie",
  czujność: "Czujność",
  skradanie: "Skradanie się",
  ukrywanie: "Ukrywanie się",
  maskowanie: "Maskowanie",
  łowiectwo: "Łowiectwo",
  znaj_teren: "Znajomość terenu",
  zdob_wody: "Zdobywanie wody",

  zastraszanie: "Zastraszanie",
  perswazja: "Perswazja",
  zdol_przywódcze: "Zdolności przywódcze",
  postrz_emocje: "Postrzeganie emocji",
  blef: "Blef",
  opieka_zwierz: "Opieka nad zwierzętami",
  odp_na_ból: "Odporność na ból",
  niezłomność: "Niezłomność",
  morale: "Morale",

  pier_pomoc: "Pierwsza pomoc",
  lecz_ran: "Leczenie ran",
  lecz_chorób: "Leczenie chorób",
  mechanika: "Mechanika",
  elektronika: "Elektronika",
  komputery: "Komputery",
  m_ciężkie: "Maszyny ciężkie",
  w_bojowe: "Wozy bojowe",
  kutry: "Kutry",
  rusznikarstwo: "Rusznikarstwo",
  wyrzutnie: "Wyrzutnie",
  mat_wyb: "Materiały wybuchowe",
  w_ogólna_1: "Wiedza ogólna",
  w_ogólna_2: "Wiedza ogólna",
  w_ogólna_3: "Wiedza ogólna",

  kondycja: "Kondycja",
  pływanie: "Pływanie",
  wspinaczka: "Wspinaczka",
  j_konna: "Jazda konna",
  powożenie: "Powożenie",
  ujeżdżanie: "Ujeżdżanie",
};

const difficulty_values = [2, 0, -2, -5, -8, -11, -15, -20, -24];
const difficulty_treshold = [0, 10, 30, 60, 90, 120, 160, 200, 240];

const buttonlist = ["skills", "equipment", "data"];

function clamp(val, min, max) {
  return Math.max(min, Math.min(val, max));
}
function count_number(arr, target) {
  return arr.filter((n) => n === target).length;
}

//####################################
//################ROLL################
//####################################
/**
 * Calculates and adjusts the final difficulty level of a test.
 * It considers the number of 20s and 1s rolled, the skill value (if applicable),
 * and whether the test is a battle type. Future adjustments may include injuries
 * and other modifiers (TODO).
 *
 * @param {number[]} rolls - Array of rolled d20 values.
 * @param {number} current_difficulty - The base difficulty level selected by the player.
 * @param {number} max_difficulty_level - The maximum allowed difficulty level.
 * @param {number|null} skill_value - Points from the skill used to reduce difficulty; null means no skill is used.
 * @param {boolean} is_battle - Whether the test is a battle-type test.
 * @returns {number} The final adjusted difficulty level (clamped between 0 and max).
 */
function set_difficulty_level(
  rolls,
  current_difficulty,
  max_difficulty_level,
  skill_value = null,
  is_battle = false
) {
  let difficulty_level = current_difficulty;

  if (skill_value < 1 && skill_value !== null) {
    difficulty_level++;
  } else if (!is_battle) {
    difficulty_level -= Math.floor(skill_value / 4);
  }
  difficulty_level = Math.max(
    0,
    Math.min(difficulty_level, max_difficulty_level)
  );

  difficulty_level += count_number(rolls, 20);
  difficulty_level -= count_number(rolls, 1);
  difficulty_level = Math.max(
    0,
    Math.min(difficulty_level, max_difficulty_level)
  );
  return difficulty_level;
}

/**
 * Calculates the total number of failed rolls in a classic test.
 *
 * Each element in the `flags` array represents the result of a single die:
 * `0` means success, `1` means failure.
 *
 * @param {number[]} flags - Array of flags where 0 is a success and 1 is a failure.
 * @returns {number} The number of failed rolls (i.e., total test result).
 */
function calculate_result_test_classic(flags) {
  return flags.reduce((partialSum, a) => partialSum + a, 0);
}

/**
 * Calculates the result of an open test.
 *
 * In an open test, the second-lowest die result is compared to the difficulty.
 * Skill points can be used to reduce the lower dice values, starting with the second-lowest.
 *
 * @param {number[]} rolls - Array of rolled d20 values.
 * @param {number} difficulty - The difficulty level that needs to be beaten.
 * @param {number} [points=0] - Points that can be spent to reduce rolls; 0 means no skill is used (WSP test).
 * @returns {number} The difference between the difficulty and the (possibly reduced) second-lowest die value.
 */
function calculate_result_test_open(rolls, difficulty, points = 0) {
  if (rolls.length < 2) {
    return 0;
  }
  const sorted_dices = rolls.concat().sort(function (a, b) {
    return a - b;
  });
  let min1 = sorted_dices[0];
  let min2 = sorted_dices[1];
  while (points && min2 > 1) {
    if (min2 > min1) {
      min2--;
    } else {
      min1--;
    }
    points--;
  }
  return difficulty - min2;
}

/**
 * Creates a flag array indicating success or failure for each roll.
 *
 * A value of `0` in the returned array means success, and `1` means failure.
 * Rolls higher than the difficulty can be reduced using available skill points.
 * In a combat test, encountering a natural 20 stops the evaluation early.
 *
 * @param {number[]} rolls - Array of d20 roll values.
 * @param {number} difficulty - The base difficulty to beat or meet.
 * @param {number} points - Points that can be spent to reduce roll values.
 * @param {boolean} [is_combat=false] - If true, encountering a 20 halts further evaluation (used in combat tests).
 * @returns {number[]} An array of 0s and 1s indicating success (0) or failure (1) for each roll.
 */
function create_flag_success(rolls, difficulty, points, is_combat = false) {
  const result = Array(rolls.length).fill(1);

  const indexedRolls = rolls
    .map((val, i) => [i, val])
    .sort((a, b) => a[1] - b[1]);

  for (const [i, val] of indexedRolls) {
    if (val === 20 && is_combat) break;
    const diff = val - difficulty;
    if (diff > points) continue;
    if (val > difficulty) {
      points -= diff;
    }
    result[i] = 0;
  }

  return result;
}

/**
 * Executes a skill or attribute test, formats the roll template,
 * assigns necessary values, and calculates the result.
 *
 * @param {string} template - Name of the Roll20 rolltemplate to use.
 * @param {string} name - Display name of the test (e.g. attribute or skill name).
 * @param {string} wsp - Base attribute used for the test.
 * @param {string} wsp_mod - Modifier for the base attribute.
 * @param {string} [skill=null] - Optional skill associated with the test, used to reduce the number of dice.
 */
function roll_test(template, name, wsp, wsp_mod, skill = null, dice = 3) {
  const attrs_arr = [
    wsp,
    wsp_mod,
    skill,
    "difficulty_lvl",
    "difficulty_max_lvl",
    "test_type_txt",
  ].filter((a) => typeof a === "string" && a.length);
  const rollTemplate = `
    &{template:${template}}
    {{test_name=${name}}}
    {{difficulty_lvl_val=[[0[computed value]]]}}
    {{test_type_txt=[[0[computed value]]]}}
    {{res=[[0[computed value]]]}}
    {{roll1=[[1d20]]}}
    {{roll2=[[1d20]]}}
    {{roll3=[[1d20]]}}
    {{test_type_txt=[[0]]}}
    {{status1=[[0[computed value]]]}}
    {{status2=[[0[computed value]]]}}
    {{status3=[[0[computed value]]]}}
    {{options=[[1]]}}
    {{dice=[[${dice}]]}}
    {{topen=[T. Otwarty](~@{character_name}|open)}}
    {{tcombat=[T. Walki](~@{character_name}|combat)}}
  `
    .trim()
    .replace(/\n+/g, " ");

  startRoll(rollTemplate, (results) => {
    const refference_rolls = [
      results.results.roll1.result,
      results.results.roll2.result,
      results.results.roll3.result,
    ];
    const roll_dices = refference_rolls.slice(0, dice);
    getAttrs(attrs_arr, function (values) {
      let difficulty_classic =
        parseInt(values[wsp] || 0) + parseInt(values[wsp_mod] || 0);
      let difficulty_combat = difficulty_classic;
      const max_level_difficulty = clamp(
        parseInt(values["difficulty_max_lvl"]) || 6,
        6,
        8
      );
      const skill_value = skill === null ? null : parseInt(values[skill] || 0);
      const difficulty_mod_classic = set_difficulty_level(
        roll_dices,
        parseInt(values["difficulty_lvl"] || 0),
        max_level_difficulty,
        skill_value
      );
      const difficulty_mod_combat = set_difficulty_level(
        roll_dices,
        parseInt(values["difficulty_lvl"] || 0),
        max_level_difficulty,
        skill_value,
        true
      );

      difficulty_classic += difficulty_values[difficulty_mod_classic];
      difficulty_combat += difficulty_values[difficulty_mod_combat];

      const flags_classic = create_flag_success(
        roll_dices,
        difficulty_classic,
        skill_value
      );
      const flags_combat = create_flag_success(
        roll_dices,
        difficulty_combat,
        skill_value,
        true
      );
      const final_result_classic = calculate_result_test_classic(flags_classic);
      const final_result_classic_open = calculate_result_test_open(
        roll_dices,
        difficulty_classic,
        skill === null ? 0 : skill_value
      );
      const final_result_combat = calculate_result_test_classic(flags_combat);
      const final_result_combat_open = calculate_result_test_open(
        roll_dices,
        difficulty_combat,
        skill === null ? 0 : skill_value
      );
      setAttrs({
        last_test_name: name,
        last_combat_status1: flags_combat[0] || 0,
        last_combat_status2: flags_combat[1] || 0,
        last_combat_status3: flags_combat[2] || 0,
        last_combat_roll1: refference_rolls[0] || 0,
        last_combat_roll2: refference_rolls[1] || 0,
        last_combat_roll3: refference_rolls[2] || 0,
        last_open_test_value: final_result_classic_open || 0,
        last_combat_test_value: final_result_combat || 0,
        last_combat_opent_test_value: final_result_combat_open || 0,
        last_classic_difficulty: difficulty_mod_classic || 0,
        last_combat_difficulty: difficulty_mod_combat || 0,
        last_dice_number: dice || 0,
      });
      finishRoll(results.rollId, {
        status1: flags_classic[0],
        status2: flags_classic[1],
        status3: flags_classic[2],
        res: final_result_classic,
        difficulty_lvl_val: difficulty_mod_classic,
      });
    });
  });
}
/**
 * ====================================
 * =========== ASSIGN ROLLS ===========
 * ====================================
 */
wsp_code.forEach((element) => {
  on(
    `change:${element} change:${element}_mod change:difficulty_lvl sheet:opened`,
    function () {
      getAttrs(
        ["difficulty_lvl", element, `${element}_mod`, "difficulty_max_lvl"],
        function (values) {
          const max_level_difficulty = clamp(
            parseInt(values["difficulty_max_lvl"]) || 6,
            6,
            8
          );
          const difficulty_lvl_index = clamp(
            parseInt(values["difficulty_lvl"]) || 0,
            0,
            max_level_difficulty
          );
          const wsp = clamp(parseInt(values[element]) || 0, 0, 50);
          const wsp_mod = clamp(parseInt(values[`${element}_mod`]) || 0, 0, 50);
          setAttrs({
            [`difficulty_${element}`]:
              wsp + wsp_mod + difficulty_values[difficulty_lvl_index],
          });
        }
      );
    }
  );
});

for (const [key, value] of Object.entries(skill_code)) {
  on(`clicked:test_${key}`, () => {
    roll_test("test", wsp_code_translate[key], key, `${key}_mod`);
  });
  value.forEach((element) => {
    on(`clicked:test_${element}`, () => {
      roll_test(
        "test",
        `${skill_code_translate[element]}(${wsp_code_translate[key]})`,
        key,
        `${key}_mod`,
        element
      );
    });
  });
}
/**
 * ===================================
 * ============ DIFFICULTY ===========
 * ===================================
 */
on("change:difficulty_lvl sheet:opened", function () {
  getAttrs(["difficulty_lvl", "difficulty_max_lvl"], function (values) {
    const max_level_difficulty = clamp(
      parseInt(values.difficulty_max_lvl) || 0,
      6,
      8
    );
    const difficulty_lvl_index = clamp(
      parseInt(values.difficulty_lvl) || 0,
      0,
      8
    );
    if (difficulty_lvl_index > max_level_difficulty) {
      setAttrs({
        difficulty_lvl: max_level_difficulty,
      });
    }
  });
});
on("change:difficulty_max_lvl sheet:opened", function () {
  getAttrs(["difficulty_lvl", "difficulty_max_lvl"], function (values) {
    const max_level_difficulty = clamp(
      parseInt(values.difficulty_max_lvl) || 0,
      6,
      8
    );
    const difficulty_lvl_index = clamp(
      parseInt(values.difficulty_lvl) || 0,
      0,
      8
    );
    if (difficulty_lvl_index > max_level_difficulty) {
      setAttrs({
        difficulty_lvl: max_level_difficulty,
      });
    }
  });
});

buttonlist.forEach((button) => {
  on(`clicked:${button}`, function () {
    setAttrs({
      sheet_container: button,
    });
  });
});

/**
 * ================================== REPEATING ===================================
 */

/**
 * ====================================
 * =========== MELEE WEAPON ===========
 * ====================================
 */
on("clicked:repeating_weapons:rolledweapon", function (eventInfo) {
  const rowId = eventInfo.sourceAttribute.split("_")[2];
  const prefix = `repeating_weapons_${rowId}_`;

  const attrsToGet = [
      `${prefix}weapon_name`,
      `${prefix}weapon_damage`,
      `${prefix}weapon_skill_value`,
      `${prefix}weapon_type`,
      `${prefix}weapon_location`,
      `${prefix}weapon_pp`,
      `${prefix}weapon_segment`
  ];

  getAttrs(attrsToGet, function (values) {
      const skill_value = values[`${prefix}weapon_skill_value`];
      console.log(values[`${prefix}weapon_skill_value`])
      const skill = skill_value === "0" ? null : skill_value;

      const skill_name = skill === null
          ? "Zręczność"
          : `${skill_code_translate[skill]}(Zręczność)`;

      const dice = clamp(parseInt(values[`${prefix}weapon_segment`]) || 0, 1, 3);

      roll_test("test", skill_name, "zre", "zre_mod", skill, dice);
  });
});

on("change:repeating_weapons:weapon_skill", function (eventInfo) {
    const rowId = eventInfo.sourceAttribute.split("_")[2];
    const fullAttr = `repeating_weapons_${rowId}_weapon_skill`;
  
    getAttrs([fullAttr], function (values) {
      const weaponType = values[fullAttr];
      setAttrs({
        [`repeating_weapons_${rowId}_weapon_skill_value`]: weaponType,
      });
    });
  });

/**
 * ===================================
 * ========== RANGE WEAPON ===========
 * ===================================
 */
on("clicked:repeating_ranges:rolledrange", function (eventInfo) {
  const rowId = eventInfo.sourceAttribute.split("_")[2];
  const prefix = `repeating_ranges_${rowId}_`;

  const attrsToGet = [
      `${prefix}range_name`,
      `${prefix}range_damage`,
      `${prefix}range_skill_value`,
      `${prefix}range_type`,
      `${prefix}range_location`,
      `${prefix}range_pp`,
      `${prefix}range_segment`
  ];

  getAttrs(attrsToGet, function (values) {
      const skill_value = values[`${prefix}range_skill_value`];
      console.log(values[`${prefix}range_skill_value`])
      const skill = skill_value === "0" ? null : skill_value;

      const skill_name = skill === null
          ? "Zręczność"
          : `${skill_code_translate[skill]}(Zręczność)`;

      const dice = clamp(parseInt(values[`${prefix}range_segment`]) || 0, 1, 3);

      roll_test("test", skill_name, "zre", "zre_mod", skill, dice);
  });
});

on("change:repeating_ranges:range_skill", function (eventInfo) {
    const rowId = eventInfo.sourceAttribute.split("_")[2];
    const fullAttr = `repeating_ranges_${rowId}_range_skill`;
  
    getAttrs([fullAttr], function (values) {
      const rangeType = values[fullAttr];
      setAttrs({
        [`repeating_ranges_${rowId}_range_skill_value`]: rangeType,
      });
    });
  });</script><rolltemplate class="sheet-rolltemplate-test">
    <div class="sheet-rolltemplate-container">
        <div class="sheet-rolltemplate-info">
            <h2>{{test}}
                {{test_name}} - 
                {{#rollTotal() computed::test_type_txt 0}}Test Zamknięty{{/rollTotal() computed::test_type_txt 0}}
                {{#rollTotal() computed::test_type_txt 1}}Test Otwarty{{/rollTotal() computed::test_type_txt 1}}
                {{#rollTotal() computed::test_type_txt 2}}Test Walki{{/rollTotal() computed::test_type_txt 2}}
                {{#rollTotal() computed::test_type_txt 3}}Test Walki Otwarty{{/rollTotal() computed::test_type_txt 3}}
            </h2>
            <h2>
                {{#rollTotal() computed::difficulty_lvl_val 0}}Łatwy{{/rollTotal() computed::difficulty_lvl_val 0}}
                {{#rollTotal() computed::difficulty_lvl_val 1}}Przeciętny{{/rollTotal() computed::difficulty_lvl_val 1}}
                {{#rollTotal() computed::difficulty_lvl_val 2}}Problematyczny{{/rollTotal() computed::difficulty_lvl_val 2}}
                {{#rollTotal() computed::difficulty_lvl_val 3}}Trudny{{/rollTotal() computed::difficulty_lvl_val 3}}
                {{#rollTotal() computed::difficulty_lvl_val 4}}Bardzo Trudny{{/rollTotal() computed::difficulty_lvl_val 4}}
                {{#rollTotal() computed::difficulty_lvl_val 5}}Cholernie Trudny{{/rollTotal() computed::difficulty_lvl_val 5}}
                {{#rollTotal() computed::difficulty_lvl_val 6}}Fartowny{{/rollTotal() computed::difficulty_lvl_val 6}}
                {{#rollTotal() computed::difficulty_lvl_val 7}}Mistrzowski{{/rollTotal() computed::difficulty_lvl_val 7}}
                {{#rollTotal() computed::difficulty_lvl_val 8}}Arcymistrzowski{{/rollTotal() computed::difficulty_lvl_val 8}}
            </h2>              
            <h2>
                {{#rollTotal() computed::test_type_txt 0}}
                    {{#rollBetween() computed::res 0 1}}Sukces{{/rollBetween() computed::res 0 1}}
                    {{#rollBetween() computed::res 2 3}}Porażka{{/rollBetween() computed::res 2 3}}
                {{/rollTotal() computed::test_type_txt 0}}
                {{#rollTotal() computed::test_type_txt 1}}
                {{#rollBetween() computed::res 0 100}}Punkty sukcesu:{{/rollBetween() computed::res 0 100}}
                {{#rollBetween() computed::res -100 -1}}Punkty porażki:{{/rollBetween() computed::res -100 -1}}
                <span class="sheet-rolltemplate-open-result">{{computed::res}}</span>
                {{/rollTotal() computed::test_type_txt 1}}
            </h2>
        </div>
        <div class="sheet-rolltemplate-rolls">
            {{#rollBetween() dice 1 3}}
            {{#rollTotal() computed::status1 0}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-succ">
            {{/rollTotal() computed::status1 0}}
            {{#rollTotal() computed::status1 1}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-fail">
            {{/rollTotal() computed::status1 1}}
                <p class="sheet-rolltemplate-result-dice-value">{{roll1}}</p>
            </div>
            {{/rollBetween() dice 1 3}}
            {{#rollBetween() dice 2 3}}
            {{#rollTotal() computed::status2 0}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-succ">
            {{/rollTotal() computed::status2 0}}
            {{#rollTotal() computed::status2 1}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-fail">
            {{/rollTotal() computed::status2 1}}
                <p class="sheet-rolltemplate-result-dice-value">{{roll2}}</p>
            </div>
            {{/rollBetween() dice 2 3}}
            {{#rollBetween() dice 3 3}}
            {{#rollTotal() computed::status3 0}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-succ">
            {{/rollTotal() computed::status3 0}}
            {{#rollTotal() computed::status3 1}}
            <div class="sheet-rolltemplate-value-testing sheet-rolltemplate-value-testing-fail">
            {{/rollTotal() computed::status3 1}}
            <p class="sheet-rolltemplate-result-dice-value">{{roll3}}</p>
            </div>
            {{/rollBetween() dice 3 3}}
        </div>
        {{#rollTotal() options 1}}
        <div class="sheet-rolltemplate-rolls">
            {{topen}}
            {{tcombat}}
        </div>
        {{/rollTotal() options 1}}
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-hit-location">
    <h1>
        {{name}} wyrzuca {{result}} i trafia<br>
    {{#rollBetween() result 1 2}} Głowa(1-2)</h1>{{/rollBetween() result 1 2}}
    {{#rollBetween() result 3 4}} Prawa ręka(3-4)</h1>{{/rollBetween() result 3 4}}
    {{#rollBetween() result 5 6}} Lewa Ręka(5-6)</h1>{{/rollBetween() result 5 6}}
    {{#rollBetween() result 7 15}} Korpus(7-15)</h1>{{/rollBetween() result 7 15}}
    {{#rollBetween() result 16 17}} Prawa Noga(16-17)</h1>{{/rollBetween() result 16 17}}
    {{#rollBetween() result 18 19}} Lewa Noga(18-1)</h1>{{/rollBetween() result 18 19}}
</rolltemplate>
